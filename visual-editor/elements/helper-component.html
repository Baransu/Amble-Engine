<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="helper-component">

	<style>

    :host {
        position: absolute;
        z-index: 9999;
        color: white;
        background-color: #424242;
        padding: 10px;
        border: 1px solid black;
    }

	.collection-item {
		cursor: pointer;
	}

    #list {
        overflow-y: scroll;
		height: 75%;
    }


	</style>

	<template>

		<div class="input-filed">
			<input id="inputBox" type="text" value="{{filterText::input}}" placeholder="Search" on-input="input" on-change="enter">
		</div>
        <div id="list" class="collection">
            <template id="componentsList" is="dom-repeat" items="{{ comp }}" filter="filterRoom" as="i">
				<a class="collection-item grey-text text-darken-4" id="{{i.idName}}" on-click="handleClick">{{i.idName}}</a>
            </template>
        </div>

	</template>

</dom-module>

<script>

    var fs = require('fs');

	Polymer({
		is: 'helper-component',
        properties: {
            filterText: {
                value: '',
                observer: 'refreshFilter'
            }
        },

		attached: function(){
			this.$.inputBox.focus();
		},

        ready: function(){
            this.comp = JSON.parse(fs.readFileSync('./visual-editor/components.json', 'utf8')).components;
			this.components = [];
        },

        filterRoom: function(item) {
			if(item.idName.match(new RegExp(this.filterText, 'i'))) {
				this.components.push(item);
				return true;
			} else {
				return false;
			};
        },

        refreshFilter: function() {
            this.$.componentsList.render();
        },

		enter: function(e){
			Amble.app.scene.children[1].scripts[0].addComponent(this.components[0].idName);
		},

		input: function(){
			this.components = [];
		},

        handleClick: function(e) {
            Amble.app.scene.children[1].scripts[0].addComponent(e.target.id);
        }

	});

</script>
